<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>T.A.R.A Safety Assistant</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

body{
    font-family:Arial;
    background:#05070d;
    color:white;
    text-align:center;
    margin:0;
}

/* AVATAR */

#avatarContainer{
    margin-top:20px;
}

#avatar{
    width:180px;
    border-radius:50%;
    box-shadow:0 0 25px #00ffc3;
    animation:pulse 3s infinite;
}

.talking{
    animation:talkGlow .4s infinite alternate;
}

@keyframes pulse{
    0%{box-shadow:0 0 15px #00ffc3;}
    50%{box-shadow:0 0 35px #00ffc3;}
    100%{box-shadow:0 0 15px #00ffc3;}
}

@keyframes talkGlow{
    from{
        transform:scale(1);
        box-shadow:0 0 20px #00ffc3;
    }
    to{
        transform:scale(1.05);
        box-shadow:0 0 45px #00ffc3;
    }
}

/* CHAT */

#chat{
    height:420px;
    max-width:600px;
    margin:20px auto;
    background:#0c1220;
    border-radius:10px;
    padding:15px;
    overflow-y:auto;
    text-align:left;
}

.msgUser{
    background:#1a2238;
    padding:10px;
    margin:8px;
    border-radius:8px;
}

.msgTara{
    background:#00ffc3;
    color:black;
    padding:10px;
    margin:8px;
    border-radius:8px;
}

/* INPUT */

#controls{
    margin-top:10px;
}

#question{
    width:60%;
    padding:12px;
    font-size:16px;
    border-radius:6px;
    border:none;
}

button{
    padding:12px 18px;
    font-size:16px;
    margin:5px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}

#askBtn{
    background:#00ffc3;
}

#voiceBtn{
    background:#ffaa00;
}

/* FOOTER */

#footer{
    margin-top:25px;
    opacity:.7;
}

#logo{
    width:140px;
    margin-top:10px;
}

</style>
</head>

<body>

<h2>T.A.R.A Safety Assistant</h2>

<div id="avatarContainer">
<img id="avatar" src="tara-avatar.png">
</div>

<div id="chat"></div>

<div id="controls">

<input id="question" placeholder="Ask T.A.R.A about towing safety...">

<br>

<button id="askBtn">Send</button>

<button id="voiceBtn">ðŸŽ¤ Speak</button>

</div>

<div id="footer">

<p>
Powered by Safety Intelligence<br>
This is our test prototype and my dad is still working on me
</p>

<img id="logo" src="taralogo.jpg">

</div>

<script>

const chat = document.getElementById("chat");
const input = document.getElementById("question");
const askBtn = document.getElementById("askBtn");
const voiceBtn = document.getElementById("voiceBtn");
const avatar = document.getElementById("avatar");

let recognizing = false;
let recognition;


/* AUTO SCROLL */

function scrollBottom(){

chat.scrollTop = chat.scrollHeight;

}


/* CHAT MESSAGE */

function addMessage(text,type){

const div=document.createElement("div");

div.className = type==="user" ? "msgUser" : "msgTara";

div.innerText=text;

chat.appendChild(div);

scrollBottom();

}


/* SPEAK */

function speak(text){

const speech = new SpeechSynthesisUtterance(text);

speech.rate = .95;

speech.onstart=()=>avatar.classList.add("talking");

speech.onend=()=>avatar.classList.remove("talking");

speechSynthesis.speak(speech);

}


/* ASK SERVER */

async function ask(){

const question=input.value.trim();

if(!question)return;

addMessage("You: "+question,"user");

input.value="";

try{

const res=await fetch("/ask",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({question})

});

const data=await res.json();

addMessage("T.A.R.A: "+data.answer,"tara");

speak(data.answer);

}
catch{

const mock="Always verify tow points, secure vehicle, and follow manufacturer procedures.";

addMessage("T.A.R.A: "+mock,"tara");

speak(mock);

}

}


/* BUTTON */

askBtn.onclick=ask;


/* ENTER KEY */

input.addEventListener("keypress",e=>{

if(e.key==="Enter")ask();

});


/* VOICE */

if("webkitSpeechRecognition" in window){

recognition=new webkitSpeechRecognition();

recognition.continuous=false;

recognition.lang="en-US";

recognition.onresult=e=>{

input.value=e.results[0][0].transcript;

ask();

};

recognition.onend=()=>{

recognizing=false;

voiceBtn.innerText="ðŸŽ¤ Speak";

};

voiceBtn.onclick=()=>{

if(recognizing){

recognition.stop();

recognizing=false;

voiceBtn.innerText="ðŸŽ¤ Speak";

}
else{

recognition.start();

recognizing=true;

voiceBtn.innerText="â–  Stop";

}

};

}
else{

voiceBtn.style.display="none";

}

</script>

</body>
</html>
